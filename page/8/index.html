<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 8 | ac黄的博客 | acwong&#39;s blog</title>

  
  <meta name="author" content="acwong">
  

  
  <meta name="description" content="ac黄的博客">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="ac黄的博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ac黄的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">ac黄的博客</a>
    </h1>
    <p class="site-description">acwong&#39;s blog</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
        
      
        <li><a href="/archives">Archives</a></li>
        
      
        <li><a href="/tags">Tags</a></li>
        
      
        <li><a href="/categories">Categories</a></li>
        
      
        
        <li><a href="mailto:acwong@yeah.net">Email</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2015/03/23/make-animation-with-steps-and-css-sprite/"><span>利用 CSS animation 和 CSS sprite 制作动画</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/03/23/make-animation-with-steps-and-css-sprite/" rel="bookmark">
        <time class="entry-date published" datetime="2015-03-23T13:40:32.000Z">
          2015-03-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>CSS3 大大强化了制作动画的能力，但是如果要做出图案比较复杂的动画，选择 GIF 依然是一个不错的选择。今天给大家介绍一个使用 CSS animation 配合雪碧图(CSS sprite)来制作动画的方法，可以做出类似于 GIF 动画的效果。</p>
<h2 id="CSS3-Animation-steps函数"><a href="#CSS3-Animation-steps函数" class="headerlink" title="CSS3 Animation steps函数"></a>CSS3 Animation steps函数</h2><p>首先看看，CSS3 animation的<a target="_blank" rel="noopener" href="http://caniuse.com/#feat=css-animation">兼容性</a>。可以看到基本上主流浏览器都支持了 animation 属性，chrome、safari、opera和移动端的浏览器带上前缀就可以支持。</p>
<p>利用雪碧图来制作动画使用了 CSS3 Animation 里面的一个重要的函数 <code>steps</code>。</p>
<p>animation 本身是一个复合的属性，它包含了 <em>animation-name</em>，<em>animation-timing-function</em>，<em>animation-iteration-count</em>，<em>animation-direction</em>，<em>animation-play-state</em>，<em>animation-fill-mode</em> 六个属性。</p>
<p><code>steps</code> 就是属于 <em>animation-timing-function</em> 中的一个函数。</p>
<p><em>animation-timing-function</em> 平时我们用的比较多的是默认的一些动画曲线值 <code>ease</code>、<code>ease-in</code> 等等。而 <code>steps</code> 则可以由我们控制动画被分成多少个部分进行。</p>
<p><code>steps(n,[start|end])</code> 传入一到两个参数，第一个参数意思是把动画分成 n 等分，然后动画就会平均地运行。第二个参数 start 表示从动画的开头开始运行，相反，end 就表示从动画的结尾开始运行，默认值为 end。</p>
<p>因此，我们利用雪碧图和 <code>steps</code> 函数制作动画的原理就是，雪碧图包含了动画图片的每一帧，然后利用 <code>steps</code> 函数确定固定时间内动画运行的部分等于动画的帧数，从而实现动画效果。</p>
<h2 id="动画实例"><a href="#动画实例" class="headerlink" title="动画实例"></a>动画实例</h2><p>用猥琐的兔斯基做例子╮(￣▽￣”)╭</p>
<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_tuski-gif.gif" alt="兔斯基gif"></p>
<p>首先我们要切图，把动画的每一帧切成这样的图:</p>
<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_tuski-sprite.png" alt="兔斯基雪碧图"></p>
<p>切图如果大家不想折腾，推荐<a target="_blank" rel="noopener" href="http://alloyteam.github.io/gopng/">在线合并雪碧图的工具</a>。</p>
<p>然后写 keyframes</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@-webkit-keyframes</span> tuski &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>:<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: -<span class="number">576px</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-moz-keyframes</span> tuski &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>:<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: -<span class="number">576px</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> tuski &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>:<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: -<span class="number">576px</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用动画</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#tuski</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">animation</span>: tuski .<span class="number">5s</span> <span class="built_in">steps</span>(<span class="number">12</span>) infinite;</span><br><span class="line">    -moz-<span class="attribute">animation</span>: tuski .<span class="number">5s</span> <span class="built_in">steps</span>(<span class="number">12</span>) infinite;</span><br><span class="line">    <span class="attribute">animation</span>: tuski .<span class="number">5s</span> <span class="built_in">steps</span>(<span class="number">12</span>) infinite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与 GIF 相比，这种动画可以让我们手动调整动画运行的速度。</p>
<p>点<a target="_blank" rel="noopener" href="http://jsfiddle.net/acwong/7hoz365p/2/">这里</a>看完整的代码。</p>
<p>大功告成。</p>
<p>感谢您的阅读，有不足之处请为我指出。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/技术研究/">技术研究</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/CSS/">CSS</a><a href="/tags/CSS3/">CSS3</a><a href="/tags/CSS3动画/">CSS3动画</a><a href="/tags/雪碧图/">雪碧图</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/03/17/common-picture-hover-effects/"><span>一些常见的图片 hover 效果</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/03/17/common-picture-hover-effects/" rel="bookmark">
        <time class="entry-date published" datetime="2015-03-17T04:08:31.000Z">
          2015-03-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>图片 hover 效果是指鼠标移上图片时候产生的一些交互效果，在各大网站上都非常常见，这里介绍一下一些常见的图片 hover 效果以及它们的实现方式。</p>
<h2 id="图片透明度改变效果"><a href="#图片透明度改变效果" class="headerlink" title="图片透明度改变效果"></a>图片透明度改变效果</h2><p>改变透明度是我们最常见的图片 hover 效果，实现方式也非常简单，只要鼠标移动到图片上的时候改变它的透明度就可以了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 减少透明度 */</span></span><br><span class="line"><span class="selector-id">#pic1</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#pic1</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加透明度 */</span></span><br><span class="line"><span class="selector-id">#pic2</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#pic1</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以加上一些过渡效果。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#pic1</span>, <span class="selector-id">#pic2</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://jsfiddle.net/acwong/nrwkfq91/">看例子</a></p>
<p>网站实例：<a target="_blank" rel="noopener" href="http://huaban.com/">花瓣网</a></p>
<h2 id="遮罩层效果"><a href="#遮罩层效果" class="headerlink" title="遮罩层效果"></a>遮罩层效果</h2><p>第二种效果也非常常见，就是在图片上面添加一层遮罩层，鼠标移动到图片上方时实现各种效果。</p>
<h3 id="遮罩层透明度改变效果"><a href="#遮罩层透明度改变效果" class="headerlink" title="遮罩层透明度改变效果"></a>遮罩层透明度改变效果</h3><p>与上面改变透明度的方法类似，但是这里不是直接改变图片的透明度，而是在图片外添加一个透明的遮罩层。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加上遮罩层 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_example-picture.jpg&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pic1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mask1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pic</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">5s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以添加不同的效果。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#mask1</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: chocolate;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> <span class="selector-id">#mask1</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#mask2</span> &#123;</span><br><span class="line">     <span class="attribute">background-color</span>:black;</span><br><span class="line">     <span class="attribute">opacity</span>:<span class="number">0.3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> <span class="selector-id">#mask2</span> &#123;</span><br><span class="line">     <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 渐变效果 */</span></span><br><span class="line"><span class="selector-id">#mask3</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">linear-gradient</span>(top,orange,chocolate);</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">-webkit-linear-gradient</span>(top,orange,chocolate);</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">-moz-linear-gradient</span>(top,orange,chocolate);</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0.5</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> <span class="selector-id">#mask3</span> &#123;</span><br><span class="line">     <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://jsfiddle.net/acwong/nrwkfq91/1/">看例子</a></p>
<p>网站实例：<a target="_blank" rel="noopener" href="http://www.lofter.com/">LOFTER</a>、<a target="_blank" rel="noopener" href="http://www.36kr.com/">36氪</a></p>
<h3 id="遮罩层位移效果"><a href="#遮罩层位移效果" class="headerlink" title="遮罩层位移效果"></a>遮罩层位移效果</h3><p>第二种遮罩层显示效果是遮罩层从各个方向移动到图片上方，此时遮罩层通常会承载对图片补充文字说明的功能。常见与内容、资讯、新闻网站。</p>
<p>首先设置外层元素 <code>overflow:hidden</code> 暂时隐藏或隐藏一部分遮罩层，当鼠标移到图片上时候才以各种形式出现。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pic</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mask</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0.5</span>;</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">5s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加各种效果。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#mask1</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:chocolate;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">0</span>;<span class="attribute">top</span>:<span class="number">256px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> <span class="selector-id">#mask1</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#mask2</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:black;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">color</span>:white;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> <span class="selector-id">#mask2</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以配合 JavaScript做出更加复杂的动画效果。</p>
<p>仿照<a target="_blank" rel="noopener" href="http://news.baidu.com/#media">百度新闻</a>做一个鼠标从不同方向进入图片显示不同效果的功能。</p>
<p>首先将遮罩层隐藏。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pic</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mask</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:absolute;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:chocolate;</span><br><span class="line">    <span class="attribute">opacity</span>:<span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#mask1</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">256px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断鼠标进入图片的方向（算法参考<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/3627042/jquery-animation-for-a-hover-with-mouse-direction">stackoverflow的一个回答</a>）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getDirection</span>(<span class="params">element, event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> w = element.<span class="property">offsetWidth</span>,</span><br><span class="line">        h = element.<span class="property">offsetHeight</span>,</span><br><span class="line">        x = (event.<span class="property">pageX</span> - element.<span class="property">offsetLeft</span> - (w/<span class="number">2</span>)) * (w &gt; h ? (h/w) : <span class="number">1</span>),</span><br><span class="line">        y = (event.<span class="property">pageY</span> - element.<span class="property">offsetTop</span> - (h/<span class="number">2</span>)) * (h &gt; w ? (w/h) : <span class="number">1</span>),</span><br><span class="line">        direction = <span class="title class_">Math</span>.<span class="title function_">round</span>((((<span class="title class_">Math</span>.<span class="title function_">atan2</span>(y, x) * (<span class="number">180</span>/<span class="title class_">Math</span>.<span class="property">PI</span>)) + <span class="number">180</span>) / <span class="number">90</span>) + <span class="number">3</span>) % <span class="number">4</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> direction</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数会返回0、1、2、3分别代表上、右、下、左四个方向。</p>
<p>然后写动画的代码。利用 jQuery库。</p>
<p><a target="_blank" rel="noopener" href="https://jsfiddle.net/acwong/nrwkfq91/2/">看完整代码</a></p>
<p>网站实例：<a target="_blank" rel="noopener" href="http://news.baidu.com/">百度新闻</a></p>
<h2 id="图片变换效果"><a href="#图片变换效果" class="headerlink" title="图片变换效果"></a>图片变换效果</h2><p>图片变换最常见于电商类网站。鼠标移动到图片上的时候通常会出现位移、大小、旋转等变换方式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#img1</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">20px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#img2</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>,<span class="number">1.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#img3</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以做更加复杂的 3D 变换。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_example-picture.jpg&quot;</span> <span class="attr">id</span>=<span class="string">&quot;img4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pic</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateZ</span>(-<span class="number">128px</span>) <span class="built_in">rotateX</span>(<span class="number">90deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pic</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateZ</span>(<span class="number">128px</span>);</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.info</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>:absolute;</span><br><span class="line">    <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:black;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotateX</span>(-<span class="number">90deg</span>) <span class="built_in">translateZ</span>(<span class="number">128px</span>);</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://jsfiddle.net/acwong/nrwkfq91/3/">看完整代码</a></p>
<p>网站实例：<a target="_blank" rel="noopener" href="http://www.jd.com/?utm_source=jd.com">京东</a>、<a target="_blank" rel="noopener" href="http://www.html-js.com/article">前端乱炖</a></p>
<p>感谢您的阅读，有不足之处请为我指出。</p>
<p><strong>参考</strong></p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/3627042/jquery-animation-for-a-hover-with-mouse-direction">jQuery animation for a hover with ‘mouse direction’ —— stackoverflow</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/技术研究/">技术研究</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/CSS/">CSS</a><a href="/tags/CSS3/">CSS3</a><a href="/tags/CSS3动画/">CSS3动画</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/03/05/json-notes/"><span>JSON 笔记</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/03/05/json-notes/" rel="bookmark">
        <time class="entry-date published" datetime="2015-03-05T06:27:31.000Z">
          2015-03-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>JSON 全称为 JavaScript Object Notation(JavaScript对象表示法)，它利用与 JavaScript 对象相似的表示方法来表示数据。虽然 JSON 脱胎于 JavaScript，但是 JSON 并不属于 JavaScript 的一部分，很多的语言都可以解析和序列化 JSON。</p>
<h2 id="JSON-语法"><a href="#JSON-语法" class="headerlink" title="JSON 语法"></a>JSON 语法</h2><p>JSON 可以表示以下三种类型的值：</p>
<ul>
<li>简单值</li>
<li>对象</li>
<li>数组</li>
</ul>
<p><strong>简单值</strong>包括字符串、数值、布尔值和 null。<strong>但是要注意的是 JSON 不能表示 JavaScript 当中的一种特殊值 undefinde</strong>。</p>
<p><strong>对象</strong>，与 JavaScript对象相似，表示无序的键值对。键值对中的值可以是简单值，也可以是对象或数组。</p>
<p><strong>数组</strong>，与 JavaScript数组相似，表示一组有序的值，数组的值可以是简单值，也可以是对象或数组。</p>
<p>举个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;acwong&quot;,</span><br><span class="line">    &quot;age&quot;: 23,</span><br><span class="line">    &quot;address&quot;: &#123;</span><br><span class="line">        &quot;province&quot;: &quot;GuangDong&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;GuangZhou&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;friends&quot;: [&quot;bc&quot;, &quot;cc&quot;, &quot;dc&quot;],</span><br><span class="line">    &quot;blog&quot;: &quot;http://acwong.org&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，也是与 JavaScript对象表示方法的不同之处，JSON 字符串当中对象的属性必须加上<strong>双引号</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 正确示范</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;acwong&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 错误示范</span><br><span class="line">&#123;</span><br><span class="line">    name: &quot;acwong&quot;</span><br><span class="line">&#125;</span><br><span class="line">// 单引号也是错误的</span><br><span class="line">&#123;</span><br><span class="line">    &#x27;name&#x27;: &#x27;acwong&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-与-JSON"><a href="#JavaScript-与-JSON" class="headerlink" title="JavaScript 与 JSON"></a>JavaScript 与 JSON</h2><h3 id="JSON-对象"><a href="#JSON-对象" class="headerlink" title="JSON 对象"></a>JSON 对象</h3><p>在 JSON 诞生之初 JavaScript 处理 JSON 的方式基本就靠 <code>eval()</code> 函数。</p>
<p><code>eval()</code> 函数可以解析 JSON 然后返回 JavaScript 数组。但是由于 <code>eval()</code> 存在安全的风险，因此在 EMCAScript 5 开始有了一个新的全局对象 <strong>JSON对象</strong>用来处理 JSON。</p>
<h3 id="序列化-JSON"><a href="#序列化-JSON" class="headerlink" title="序列化 JSON"></a>序列化 JSON</h3><p>JavaScript 使用 JSON对象的 <code>stringify()</code> 方法来序列化 JSON。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">23</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">province</span>: <span class="string">&quot;GuangDong&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;GuangZhou&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">friends</span>: [<span class="string">&quot;bc&quot;</span>, <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;dc&quot;</span>],</span><br><span class="line">    <span class="attr">blog</span>: <span class="string">&quot;http://acwong.org&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br><span class="line"><span class="comment">// &#123;&quot;name&quot;:&quot;acwong&quot;,&quot;age&quot;:23,&quot;address&quot;:&#123;&quot;province&quot;:&quot;GuangDong&quot;,&quot;city&quot;:&quot;GuangZhou&quot;&#125;,&quot;friends&quot;:[&quot;bc&quot;,&quot;cc&quot;,&quot;dc&quot;],&quot;blog&quot;:&quot;http://acwong.org&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>JSON.stringify()</code> 方法在默认情况下输出的 JSON字符串不包含空格字符和缩进。</p>
<p>如果 JavaScript对象当中包含不被 JSON 支持的类型（如：undefined，函数）会自动被 <code>stringigy()</code> 方法忽略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">    <span class="attr">blog</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">todo</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sleep&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br><span class="line"><span class="comment">// &#123;&quot;name&quot;:&quot;acwong&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>JSON.stringify()</code> 方法包含三个参数，第一个参数就是要序列化的 JavaScript对象。第二个参数完成<strong>过滤</strong>输出结果功能。第三个参数控制输出字符串的<strong>缩进</strong>。</p>
<h4 id="过滤输出结果"><a href="#过滤输出结果" class="headerlink" title="过滤输出结果"></a>过滤输出结果</h4><p>第二个参数完成过滤输出结果功能。</p>
<p>当传入的第二个参数为<strong>数组</strong>时，输出的 JSON字符串只会保留包含在该数组里面的属性值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var person = &#123;</span><br><span class="line">    name: &quot;acwong&quot;,</span><br><span class="line">    age: 23,</span><br><span class="line">    address: &#123;</span><br><span class="line">        province: &quot;GuangDong&quot;,</span><br><span class="line">        city: &quot;GuangZhou&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    friends: [&quot;bc&quot;, &quot;cc&quot;, &quot;dc&quot;],</span><br><span class="line">    blog: &quot;http://acwong.org&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var jsonText = JSON.stringify(person, [&quot;name&quot;,&quot;blog&quot;]);</span><br><span class="line"></span><br><span class="line">console.log(jsonText);</span><br><span class="line">// &#123;&quot;name&quot;:&quot;acwong&quot;,&quot;blog&quot;:&quot;http://acwong.org&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>当传入的第二个参数为<strong>函数</strong>，该函数包含两个参数，分别是 JavaScript对象的属性名和属性值。输出的 JSON字符串会受到该函数的返回值影响。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略 person对象</span></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person, <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;name&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ac&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&quot;age&quot;</span>) &#123;</span><br><span class="line">        value++;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br><span class="line"><span class="comment">// &#123;&quot;name&quot;:&quot;ac&quot;,&quot;age&quot;:24,&quot;address&quot;:&#123;&quot;province&quot;:&quot;GuangDong&quot;,&quot;city&quot;:&quot;GuangZhou&quot;&#125;,&quot;friends&quot;:[&quot;bc&quot;,&quot;cc&quot;,&quot;dc&quot;],&quot;blog&quot;:&quot;http://acwong.org&quot;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="控制缩进"><a href="#控制缩进" class="headerlink" title="控制缩进"></a>控制缩进</h4><p>第三个参数控制输出字符串的<strong>缩进</strong>。</p>
<p>当第三个参数传入一个<strong>数值</strong>的时候，表示输出字符串缩进的空格数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略 person对象</span></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="number">23</span>,</span><br><span class="line">  <span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;province&quot;</span>: <span class="string">&quot;GuangDong&quot;</span>,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;GuangZhou&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;friends&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;bc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dc&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;blog&quot;</span>: <span class="string">&quot;http://acwong.org&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当第三个参数传入一个<strong>字符串</strong>时，输出结果会以该字符串作为缩进符号。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略 person对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 * 号缩进</span></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person, <span class="literal">null</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line"> &#123;</span><br><span class="line">*<span class="string">&quot;name&quot;</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">*<span class="string">&quot;age&quot;</span>: <span class="number">23</span>,</span><br><span class="line">*<span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">**<span class="string">&quot;province&quot;</span>: <span class="string">&quot;GuangDong&quot;</span>,</span><br><span class="line">**<span class="string">&quot;city&quot;</span>: <span class="string">&quot;GuangZhou&quot;</span></span><br><span class="line">*&#125;,</span><br><span class="line">*<span class="string">&quot;friends&quot;</span>: [</span><br><span class="line">**<span class="string">&quot;bc&quot;</span>,</span><br><span class="line">**<span class="string">&quot;cc&quot;</span>,</span><br><span class="line">**<span class="string">&quot;dc&quot;</span></span><br><span class="line">*],</span><br><span class="line">*<span class="string">&quot;blog&quot;</span>: <span class="string">&quot;http://acwong.org&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略 person对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用制表符(Tab)缩进</span></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person, <span class="literal">null</span>, <span class="string">&quot;\t&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line"> &#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">	<span class="string">&quot;age&quot;</span>: <span class="number">23</span>,</span><br><span class="line">	<span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;province&quot;</span>: <span class="string">&quot;GuangDong&quot;</span>,</span><br><span class="line">		<span class="string">&quot;city&quot;</span>: <span class="string">&quot;GuangZhou&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;friends&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;bc&quot;</span>,</span><br><span class="line">		<span class="string">&quot;cc&quot;</span>,</span><br><span class="line">		<span class="string">&quot;dc&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;blog&quot;</span>: <span class="string">&quot;http://acwong.org&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义序列化"><a href="#自定义序列化" class="headerlink" title="自定义序列化"></a>自定义序列化</h4><p>如果上述的方法都不能满足要求，还可以在要序列化的 JavaScript对象当中加入 <code>toJSON()</code> 函数，可以返回任何想返回的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;acwong&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">23</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">province</span>: <span class="string">&quot;GuangDong&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;GuangZhou&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">friends</span>: [<span class="string">&quot;bc&quot;</span>, <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;dc&quot;</span>],</span><br><span class="line">    <span class="attr">blog</span>: <span class="string">&quot;http://acwong.org&quot;</span>,</span><br><span class="line">    <span class="attr">toJSON</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;ac&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;yoyo &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonText = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonText);</span><br><span class="line"><span class="comment">//  &quot;yoyo ac&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="解析-JSON"><a href="#解析-JSON" class="headerlink" title="解析 JSON"></a>解析 JSON</h3><p>JavaScript 使用 JSON对象的 <code>parse()</code> 方法来解析 JSON。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var jsonText = &#x27;&#123;&quot;name&quot;:&quot;acwong&quot;,&quot;age&quot;:23,&quot;address&quot;:&#123;&quot;province&quot;:&quot;GuangDong&quot;,&quot;city&quot;:&quot;GuangZhou&quot;&#125;,&quot;friends&quot;:[&quot;bc&quot;,&quot;cc&quot;,&quot;dc&quot;],&quot;blog&quot;:&quot;http://acwong.org&quot;&#125;&#x27;;</span><br><span class="line"></span><br><span class="line">var person = JSON.parse(jsonText);</span><br><span class="line"></span><br><span class="line">console.log(person);</span><br></pre></td></tr></table></figure>

<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_parse-json.PNG" alt="parse-json"></p>
<p><code>JSON.parse()</code> 同样可以传入一个函数作为参数，对键值对进行操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var jsonText = &#x27;&#123;&quot;name&quot;:&quot;acwong&quot;,&quot;age&quot;:23,&quot;blog&quot;:&quot;http://acwong.org&quot;&#125;&#x27;;</span><br><span class="line"></span><br><span class="line">var person = JSON.parse(jsonText);</span><br><span class="line"></span><br><span class="line">console.log(person);</span><br></pre></td></tr></table></figure>

<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_parse-json-with-fun.PNG" alt="parse-json-with-fun"></p>
<h2 id="JSON-的好处"><a href="#JSON-的好处" class="headerlink" title="JSON 的好处"></a>JSON 的好处</h2><ol>
<li>与 XML 一样可以表示复杂的数据结构。</li>
<li>比 XML 轻量得多。</li>
<li>语法简单易懂。</li>
<li>由于其轻量级，在传输的时候占用的资源相对较少。</li>
</ol>
<p>感谢您的阅读，有不足之处请为我指出。</p>
<p><strong>参考</strong></p>
<p><a target="_blank" rel="noopener" href="http://book.douban.com/subject/10546125/">JavaScript高级程序设计(第3版)</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/学习笔记/">学习笔记</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/JavaScript/">JavaScript</a><a href="/tags/JSON/">JSON</a><a href="/tags/JavaScript对象/">JavaScript对象</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/03/03/node-test-of-mysql-and-redis/"><span>Node.js 练习 —— 操作 MySQL 和 Redis</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/03/03/node-test-of-mysql-and-redis/" rel="bookmark">
        <time class="entry-date published" datetime="2015-03-03T07:28:04.000Z">
          2015-03-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>新年新气象，博客换了一个新主题，继续 Node.js 小练习。</p>
<p>这次小联系的内容是生成随机激活码并把生成的激活码分别保存到 MySQL 和 Redis 当中。</p>
<p>题目来源 <a target="_blank" rel="noopener" href="https://github.com/Show-Me-the-Code/show-me-the-code">Python 练习册</a>。</p>
<h2 id="题目0001"><a href="#题目0001" class="headerlink" title="题目0001"></a>题目0001</h2><blockquote>
<p>第 0001 题：做为 Apple Store App 独立开发者，你要搞限时促销，为你的应用生成激活码（或者优惠券），使用 Python 如何生成 200 个激活码（或者优惠券）？</p>
</blockquote>
<p>这个题目需要我们生成 200个激活码。生成激活码有许多不同的方式，为了简单起见这里直接用 UUID 来代替。</p>
<p><strong>UUID(Universally Unique Identifier)</strong> 可以帮助我们简单地创建随机而且不重复的字符串。</p>
<h3 id="node-uuid"><a href="#node-uuid" class="headerlink" title="node-uuid"></a>node-uuid</h3><p>在 Node.js 中使用 <a target="_blank" rel="noopener" href="https://github.com/broofa/node-uuid">node-uuid</a> 库来生成 UUID。该库可以简单地生成符合 RFC4122 标准的版本1 和版本4的UUID。版本1和版本4之间的区别是版本1根据时间戳来生成，而版本4是随机生成。</p>
<p>安装 node-uuid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-uuid</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code.js</span></span><br><span class="line"><span class="keyword">var</span> uuid = <span class="built_in">require</span>(<span class="string">&#x27;node-uuid&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCode</span>(<span class="params">number</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> codes = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; number; i++) &#123;</span><br><span class="line">        codes.<span class="title function_">push</span>(uuid.<span class="title function_">v4</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> codes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getCode</span>(<span class="number">200</span>));</span><br></pre></td></tr></table></figure>

<p>运行 <em>code.js</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node code</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_node-uuid.PNG" alt="Node.js 生成 UUID"></p>
<h2 id="题目0002"><a href="#题目0002" class="headerlink" title="题目0002"></a>题目0002</h2><blockquote>
<p>第 0002 题：将 0001 题生成的 200 个激活码（或者优惠券）保存到 MySQL 关系型数据库中。</p>
</blockquote>
<p>首先，我们使用 <code>exports</code> 将上一题当中 <code>getCode</code> 可以被调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getCode</span> = getCode;</span><br></pre></td></tr></table></figure>

<h3 id="node-mysql"><a href="#node-mysql" class="headerlink" title="node-mysql"></a>node-mysql</h3><p>要使用 Node.js 操作 MySQL 数据库，这里使用 <a target="_blank" rel="noopener" href="https://github.com/felixge/node-mysql/">node-mysql</a> 库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql</span><br></pre></td></tr></table></figure>

<p>直接上代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code_insert_mysql.js</span></span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> code = <span class="built_in">require</span>(<span class="string">&#x27;./code.js&#x27;</span>); <span class="comment">// 引入上一题的 code.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> codes = code.<span class="title function_">getCode</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建连接</span></span><br><span class="line"><span class="keyword">var</span> conn = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;test0002&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;test0002&#x27;</span>,</span><br><span class="line">    <span class="attr">database</span>: <span class="string">&#x27;test0002&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">conn.<span class="title function_">connect</span>(<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sql_create_table = <span class="string">&#x27;CREATE TABLE IF NOT EXISTS code( &#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;id SMALLINT AUTO_INCREMENT,&#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;code CHAR(20),&#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;PRIMARY KEY(id)&#x27;</span> +</span><br><span class="line">                       <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">conn.<span class="title function_">query</span>(sql_create_table, <span class="keyword">function</span>(<span class="params">err, res</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; codes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> sql_insert_code = <span class="string">&quot;INSERT code VALUES(&#x27;code&#x27;,&#x27;&quot;</span> + codes[i] + <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">        conn.<span class="title function_">query</span>(sql_insert_code, <span class="keyword">function</span>(<span class="params">err, res</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    conn.<span class="title function_">end</span>(); <span class="comment">// 关闭连接</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node code_insert_mysql</span><br></pre></td></tr></table></figure>

<p>进入 MySQL 查询一下就可以看到数据了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM code;</span><br></pre></td></tr></table></figure>

<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_node-mysql.PNG" alt="node-mysql"></p>
<h2 id="题目0003"><a href="#题目0003" class="headerlink" title="题目0003"></a>题目0003</h2><blockquote>
<p>第 0003 题：将 0001 题生成的 200 个激活码（或者优惠券）保存到 Redis 非关系型数据库中。</p>
</blockquote>
<h3 id="node-redis"><a href="#node-redis" class="headerlink" title="node_redis"></a>node_redis</h3><p>使用 Node.js 操作 Redis，这里使用 <a target="_blank" rel="noopener" href="https://github.com/mranney/node_redis">node_redis</a> 库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redis</span><br></pre></td></tr></table></figure>

<p>直接上代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code_insert_redis.js</span></span><br><span class="line"><span class="keyword">var</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> code = <span class="built_in">require</span>(<span class="string">&#x27;./code.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = redis.<span class="title function_">createClient</span>();</span><br><span class="line"><span class="keyword">var</span> codes = code.<span class="title function_">getCode</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用 LIST 形式存储，KEY 为 codes</span></span><br><span class="line">client.<span class="title function_">rpush</span>(<span class="string">&#x27;codes&#x27;</span>, codes, <span class="keyword">function</span>(<span class="params">err, res</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 输出 1</span></span><br><span class="line">    client.<span class="title function_">quit</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node code_insert_redis</span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrange codes 0 -1</span><br></pre></td></tr></table></figure>

<p><img src="https://acwong-blog.oss-cn-shenzhen.aliyuncs.com/2015-03_node-redis.PNG" alt="node-redis"></p>
<p>感谢您的阅读，有不足之处请为我指出。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/技术实践/">技术实践</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Node-js/">Node.js</a><a href="/tags/MySQL/">MySQL</a><a href="/tags/Redis/">Redis</a><a href="/tags/关系型数据库/">关系型数据库</a><a href="/tags/NoSQL数据库/">NoSQL数据库</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/29/node-draw-number-on-head-image/"><span>Node.js 练习 —— 逼死强迫症头像</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/29/node-draw-number-on-head-image/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-29T03:35:27.000Z">
          2015-01-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近在 GitHub 上看到了一个名为 <a target="_blank" rel="noopener" href="https://github.com/Show-Me-the-Code/show-me-the-code">Python 练习册</a>的项目。这个项目让大家用 Python 来完成一些简单的小练习，题目也同样适用于其他的语言，这里就 Node.js 来写完成一些小练习。</p>
<h2 id="题目0000"><a href="#题目0000" class="headerlink" title="题目0000"></a>题目0000</h2><blockquote>
<p>将你的 QQ 头像（或者微博头像）右上角加上红色的数字，类似于微信未读信息数量那种提示效果。 类似于图中效果</p>
</blockquote>
<blockquote>
<p> <img src="https://camo.githubusercontent.com/d518d3929e4054ce2f9183b23e52908da7e5632d/687474703a2f2f692e696d6775722e636f6d2f736732646b75592e706e673f31" alt="题目0000图片"></p>
</blockquote>
<h2 id="图片库选择"><a href="#图片库选择" class="headerlink" title="图片库选择"></a>图片库选择</h2><p>这个题目要求的是在图片上添加一个数字，然后完成前阵子很流行的模拟提示数字逼死强迫症的效果。在 Python 当中要作图通常会使用 Pillow 库。而在 Node.js 当中我选择了较为全面的 <a target="_blank" rel="noopener" href="http://aheckmann.github.io/gm/">gm</a> 库。当然，还有其他的选择，可以参考 <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/10692075/which-library-should-i-use-for-server-side-image-manipulation-on-node-js">StackOverflow 的答案</a>。</p>
<h2 id="安装-gm"><a href="#安装-gm" class="headerlink" title="安装 gm"></a>安装 gm</h2><p>要使用 gm 首先要在系统安装 <a target="_blank" rel="noopener" href="http://www.graphicsmagick.org/">GraphicsMagick</a> 或者 <a target="_blank" rel="noopener" href="http://www.imagemagick.org/">ImageMagick</a>。这里我选择了 ImageMagick。在 Ubuntu 系统里面非常简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install imagemagick</span><br></pre></td></tr></table></figure>

<p>然后用 <em>npm</em> 安装 gm 库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gm</span><br></pre></td></tr></table></figure>

<h2 id="开始作图"><a href="#开始作图" class="headerlink" title="开始作图"></a>开始作图</h2><p>先来看看最终的效果：</p>
<p><img src="https://raw.githubusercontent.com/acwong00/node_exercise/master/0000/acwong2.jpg" alt="acwong_afeter"></p>
<p>因此，现在就要在原图的右上角画上一个红色的圆和白色的数字。</p>
<p>这里我主要用到 gm 的 <code>drawCircle</code> 和 <code>drawCircle</code> 的方法分别用来画圆和数字。</p>
<p>直接上代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">  , gm = <span class="built_in">require</span>(<span class="string">&#x27;gm&#x27;</span>)  <span class="comment">// 加载 gm 模块</span></span><br><span class="line">  , readStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;acwong.jpg&quot;</span>);  <span class="comment">// 创建流</span></span><br><span class="line"><span class="title function_">gm</span>(readStream,<span class="string">&#x27;acwong.jpg&#x27;</span>)</span><br><span class="line">    .<span class="title function_">options</span>(&#123;<span class="attr">imageMagick</span>: <span class="literal">true</span>&#125;)  <span class="comment">// 使用 ImageMagick </span></span><br><span class="line">    .<span class="title function_">size</span>(&#123;<span class="attr">bufferStream</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">err, size</span>)&#123;</span><br><span class="line">        <span class="comment">// 使用 size 方法获取图像的尺寸</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> width = <span class="built_in">parseInt</span>(size.<span class="property">width</span>);</span><br><span class="line">            <span class="keyword">var</span> height = <span class="built_in">parseInt</span>(size.<span class="property">width</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">fill</span>(<span class="string">&quot;#ff0000&quot;</span>);</span><br><span class="line">            <span class="comment">// 画圆</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">drawCircle</span>(width-<span class="number">30</span>, <span class="number">30</span>, width-<span class="number">30</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">fill</span>(<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">fontSize</span>(<span class="string">&quot;50&quot;</span>);</span><br><span class="line">            <span class="comment">// 画数字</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">drawText</span>(width-<span class="number">45</span>, <span class="number">50</span>, <span class="string">&quot;7&quot;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">write</span>(<span class="string">&quot;acwong2.jpg&quot;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> err;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>运行程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test</span><br></pre></td></tr></table></figure>

<p>命令行中出现 <strong>done</strong> 打开新的图片 <em>acwong2.jpg</em> 就可以看到效果了。</p>
<p>感谢您的阅读，有不足之处请为我指出。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/技术实践/">技术实践</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Node-js/">Node.js</a><a href="/tags/图像处理/">图像处理</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/7/" class="pagination-prev">Prev</a>
  
  
  <a href="/page/9/" class="pagination-next">Next</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 acwong
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>